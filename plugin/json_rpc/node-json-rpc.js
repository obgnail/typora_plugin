var o=(e,f)=>()=>(f||e((f={exports:{}}).exports,f),f.exports);var k=o((M,p)=>{var C=require("http"),S=require("https"),H=function(e){var f,i,r=this;e=e||{};var l={host:e.host||"127.0.0.1",path:e.path||"/",hash:e.hash||null,login:e.login||null};e.ssl&&(l.ssl={sniName:e.ssl.sniName||"RPC-Server",protocol:e.ssl.protocol||"SSLv3_client_method"},e.ssl.pfx?(l.ssl.pfx=e.ssl.pfx,l.ssl.strict=e.ssl.strict||!0):(e.ssl.ca&&(l.ssl.ca=e.ssl.ca,l.ssl.strict=e.ssl.strict||!0),e.ssl.key&&e.ssl.cert&&(l.ssl.key=e.ssl.key,l.ssl.cert=e.ssl.certs)),e.ssl.passphrase&&(l.ssl.passphrase=e.ssl.passphrase)),l.ssl?(f=S,i=new S.Agent,l.port=e.port||5433):(f=C,i=new C.Agent,l.port=e.port||5080);var y=function(u){var h={agent:i,method:u.method,host:l.host,port:l.port,path:u.path,headers:{host:l.host+":"+l.port,"content-type":"application/json","content-length":u.length}};return u.login&&u.hash&&(h.auth=u.login+":"+u.hash),l.ssl&&(h.servername=l.ssl.sniName||"RPC-Server",h.secureProtocol=l.ssl.protocol||"SSLv3_client_method",l.ssl.pfx?(h.pfx=l.ssl.pfx,h.rejectUnauthorized=l.ssl.strict||!0):(l.ssl.key&&l.ssl.cert&&(h.key=l.ssl.key,h.cert=l.ssl.cert),l.ssl.ca&&(h.ca=l.ssl.ca,h.rejectUnauthorized=l.ssl.strict||!0)),l.ssl.passphrase&&(h.passphrase=l.ssl.passphrase)),h};this.call=function(u,h,n){n=n||{};var s=JSON.stringify(u),t=y({length:s.length,method:n.method||"POST",path:n.path||l.path,login:n.login||l.login,hash:n.hash||l.hash}),a=f.request(t);a.on("error",function(c){console.error(c)}),a.on("response",function(c){var d="";c.on("data",function(v){d+=v}),c.on("end",function(){var v,g;if(c.statusCode===200||c.statusCode===304){if(d.length>0)try{g=JSON.parse(d)}catch(x){v=x,console.error("Client error: failed to parse response from server.")}}else console.log("Client: TODO Status Code: "+c.statusCode);h(v,g)})}),a.end(s)},e=null};p.exports=H});var b=o((B,q)=>{var R=function(e){var f=this;e=e||{};var i={},r=e.body||"<h1>401 Auth Required!</h1>",l=e.users||[],y=e.message||"Rpc Authentication";e.ext&&(typeof e.ext.log=="function"&&(i.log=e.ext.log),typeof e.ext.hash=="function"&&(i.hash=option.ext.hash),typeof e.ext.users=="function"&&(i.users=e.ext.users),typeof e.ext.block=="function"&&(i.block=e.ext.block));var u=function(s){var t=null;if(i.users)t=i.users(s);else for(var a=0;a<l.length;a++)if(l[a].login===s[0])if(i.hash)i.hash(s[1],l[a].hash)&&(t=l[a]);else{l[a].hash===s[1]&&(t=l[a]);break}return t},h=function(s){var t=null,a=s.headers.authorization;return a&&(t=u(new Buffer(a.split(" ")[1],"base64").toString("utf8").split(":"))),t},n=function(s){s.setHeader("WWW-Authenticate",'Basic realm="'+y+'"'),s.writeHead(401),s.end(r)};this.check=function(s,t,a){var c=null;c=h(s),c?i.log?i.log(s,t,c,a):a(s,t,c):i.log?i.log(s,t,null,null):n(t)}};q.exports=R});var N=o((I,O)=>{var L=require("http"),P=require("https"),U=b(),_=function(e){var f=this,i=null;e=e||{};var r={functions:{},host:e.host||"127.0.0.1",queue:e.queue||512,hash:e.hash||null,login:e.login||null};e.strict!==null?r.strict=e.strict:r.strict=!0,e.ssl&&(r.ssl={sniName:e.ssl.sniName||"RPC-Server",protocol:e.ssl.protocol||"SSLv3_server_method",clientCert:e.ssl.clientCert||!1,handshakeTimeout:e.ssl.handshakeTimeout||60,ciphers:e.ssl.ciphers||"AES128-GCM-SHA256:RC4:HIGH:!MD5:!aNULL:!EDH"},e.ssl.clientCert!==null?r.ssl.clientCert=e.ssl.clientCert:r.ssl.clientCert=!1,e.ssl.ciphersOrder!==null?r.ssl.ciphersOrder=e.ssl.ciphersOrder:r.ssl.ciphersOrder=!0,e.ssl.pfx?(r.ssl.pfx=e.ssl.pfx,e.ssl.strict!==null?r.ssl.strict=e.ssl.strict:r.ssl.strict=!0):e.ssl.key&&e.ssl.cert&&(e.ssl.ca&&(r.ssl.ca=e.ssl.ca,e.ssl.strict!==null?r.ssl.strict=e.ssl.strict:r.ssl.strict=!0),r.ssl.key=e.ssl.key,r.ssl.cert=e.ssl.certs),e.ssl.sniCallback&&(r.ssl.sniCallback=e.ssl.sniCallback),e.ssl.passphrase&&(r.ssl.passphrase=e.ssl.passphrase)),e.auth&&(e.auth.auth?r.auth=e.auth.auth:r.auth=new U(e.auth));var l=function(s,t,a){if(s||t){var c={};return r.strict&&(c.id=null,c.jsonrpc="2.0"),a&&(c.id=a),t?c.error=t:s&&(c.result=s),c}else return null},y=function(s,t){if(t.length>s.rpc.idx){var a=null,c=t[s.rpc.idx];s.rpc.idx++,r.strict&&(c.jsonrpc!=="2.0"||!c.id)?a={code:-32600,message:"Invalid Request"}:typeof c.method=="string"?typeof r.functions[c.method]=="function"?r.functions[c.method](c.params,function(d,v){var g=l(v,d,c.id);g&&s.rpc.batch.push(g),y(s,t)}):a={code:-32601,message:"Method not found"}:a={code:-32600,message:"Invalid Request"},a&&(s.rpc.batch.push(l(null,a,c.id)),y(s,t))}else s.rpc.batch.length>0?s.rpc.isBatch?s.end(JSON.stringify(s.rpc.batch)):s.end(JSON.stringify(s.rpc.batch[0])):s.end()},u=function(s,t){var a={},c=null;s.rpc={idx:0,batch:[],isBatch:!1};try{requests=JSON.parse(t)}catch(d){a=l(null,{code:-32700,message:"Parse error"}),s.end(JSON.stringify(a));return}if(Array.isArray(requests)||(requests=[requests]),requests.length>1?s.rpc.isBatch=!0:s.rpc.isBatch=!1,requests.length>0)y(s,requests);else{a=l(null,{code:-32600,message:"Invalid Request"}),s.end(JSON.stringify(a));return}},h=function(s,t){if(r.auth)r.auth.check(s,t,function(c,d,v){var g="";c.on("data",function(x){g+=x}),c.on("end",function(){d.user=v,u(d,g)})});else{var a="";s.on("data",function(c){a+=c}),s.on("end",function(){u(t,a)})}};if(r.ssl){var n={servername:r.sniName||"RPC-Server",requestCert:r.ssl.clientCert||!1,secureProtocol:r.ssl.protocol||"SSLv3_server_method",handshakeTimeout:r.ssl.handshakeTimeout||60,ciphers:r.ssl.ciphers||"AES128-GCM-SHA256:RC4:HIGH:!MD5:!aNULL:!EDH",honorCipherOrder:r.ssl.ciphersOrder||!0};r.ssl.pfx?(n.pfx=r.ssl.pfx,n.rejectUnauthorized=r.ssl.strict||!0):(r.ssl.ca&&(n.ca=r.ssl.ca,n.rejectUnauthorized=r.ssl.strict||!0),r.ssl.key&&r.ssl.cert&&(n.key=r.ssl.key,n.cert=r.ssl.cert)),r.ssl.sniCallback&&(n.SNICallback=r.ssl.sniCallback),r.ssl.passphrase&&(n.passphrase=r.ssl.passphrase);try{r.port=e.port||5433,i=P.createServer(n,h)}catch(s){console.error(s)}}else try{r.port=e.port||5080,i=L.createServer(h)}catch(s){console.error(s)}i.on("error",function(s){console.error(s)}),this.addMethod=function(s,t){s&&typeof t=="function"&&(r.functions[s]=t)},this.delMethod=function(s){r.functions[s]&&(r.functions[s]=null)},this.start=function(s){try{i.listen(r.port,r.host,r.queue,s)}catch(t){s(t)}},this.stop=function(s){try{i.close(s)}catch(t){s(t)}},e=null};O.exports=_});var A=o((T,m)=>{m.exports.Client=k();m.exports.Server=N()});var j=A();module.exports=j;
